# 用語集（Ubiquitous Language）草案 v0.1

対象：音楽スタジオの予約と備品レンタルの最小MVP。口調は関西弁で書くけど、定義は業務で使えるように丁寧めに。

---
## 1. コンテキストと時間単位
- **コンテキスト**：
  - Scheduling（予約・時間・スタジオの枠）
  - Inventory（備品・在庫・貸出/返却）
  - StudentRegistry（学生・学生番号・連絡先）
- **時間単位**：`利用日(LocalDate) × 時間枠(TimeSlot)` を基本単位にする。
  - **TimeSlot** は `Period(P1..P5)` / `HalfDay(AM|PM)` / `FullDay` のユニオン型として扱う（整合チェックを1か所に寄せる）。
  - P1..P5 の具体的な開始/終了時刻、および **HalfDay→Period** の対応（例：AM=P1–P3、PM=P4–P5）は設定で管理（将来変更に強くする）。

---
## 2. 用語と定義（初期案）
> 「NG語」は呼び方のブレを潰すための禁止・非推奨ワード。迷ったら“この表の用語”で統一する。

| 用語 | 定義 | 備考（同義語/NG語） | 型候補 | 所属コンテキスト |
|---|---|---|---|---|
| 学生 (Student) | 本サービスを利用する人。学生情報の主体。 | NG: ユーザー、顧客（今回は学生で統一） | Entity | StudentRegistry |
| 講師 (Instructor) | 授業やイベントでスタジオを予約できる教職員・講師。 | NG: 先生（画面文言は可） | Entity | StudentRegistry |
| TA (TeachingAssistant) | 受付担当のスタッフ。対面でチェックイン/チェックアウト、備品の貸出/返却を行う。 | 同義: ティーチングアシスタント／NG: 受付担当（ロール名はTAで統一） | Entity | StudentRegistry |
| 学生番号 (StudentNumber) | 学生を一意に識別する学籍番号。 | 値オブジェクト。フォーマットは後述。 | Value Object | StudentRegistry |
| 連絡先 (ContactInfo) | 学生の名前・メール・電話など。 | プライバシー配慮（最小収集）。 | Value Object | StudentRegistry |
| スタジオ (Studio) | 予約対象となる部屋。 | 例：Aスタ、Bスタ。 | Entity | Scheduling |
| 限 (Period) | 1日の時間コマ。**DBの PeriodDefinition で動的定義**（コマ数・開始/終了時刻・表示順）。 | 同義: コマ、枠／NG: タイムゾーン | Enum/Id | Scheduling |
| 半日区分 (DayHalf) | 1日の前半/後半を表す。AM/PMの2値。 | 同義: 午前/午後 | Enum | Scheduling |
| Period定義 (PeriodDefinition) | Periodごとの `periodId` / 名称 / 開始-終了 / 並び順 を保持する定義情報。**DB管理**。 | 管理UIは後日（当面はDB初期データ）。 | Master | Scheduling |
| 半日対応 (DayHalfMapping) | 各 `periodId` を AM か PM に割当てる定義。**DB管理**。 | 例: P1,P2→AM / P3,P4→PM | Master | Scheduling |
| 時間枠 (TimeSlot) | 予約の時間単位。`Period`/`HalfDay`/`FullDay` の総称。内部では当日の実時間レンジ集合に展開。 |  | Value Object | Scheduling |
| 終日 (FullDay) | 1日全体を表す時間枠。 |  | Enum | Scheduling |
| 時間枠 (TimeSlot) | 予約の時間単位。`Period`/`HalfDay`/`FullDay` の総称。 |  | Value Object | Scheduling |
| 利用日 (UsageDate) | 予約や貸出の対象日。 | LocalDateで管理。 | Primitive/VO | Scheduling |
| 予約 (Booking) | 学生/講師が特定のスタジオを、特定の日・**時間枠(TimeSlot)** で利用する申込み。学生レンタルでは **メンバー(Members)** 全員が対象。 | 集約ルート。重複予約禁止。 | Aggregate Root | Scheduling |
| 予約番号 (BookingId) | 予約の一意ID。 | UUID推奨。 | Identifier | Scheduling |
| 予約状態 (BookingStatus) | 予約のライフサイクル状態。`予約済み(Reserved)` / `予約確定(Confirmed)` / `予約キャンセル(Canceled)` | 将来「仮予約/保留」追加可。 | Enum | Scheduling |
| スタジオ枠状態 (StudioSlotStatus) | カレンダーの表示用状態。`空` / `予約済み` / `予約確定` / `使用中` / `予約キャンセル` | Booking と現在時刻・チェックイン有無から算出。 | Enum | Scheduling |
| 予約種類 (ReservationType) | 予約の目的区分。`学生レンタル` / `授業レンタル` / `イベント予約`。 | 英語: StudentRental / ClassRental / EventReservation | Enum | Scheduling |
| 予約優先度 (ReservationPriority) | 優先順は **授業レンタル > イベント予約 > 学生レンタル**。自動奪取は行わない（同時受付や手動調整時の指針）。 | 英: ClassRental > EventReservation > StudentRental | Rule | Scheduling |
| 取消期限 (CancelDeadline) | キャンセルは **前日 23:59 (Asia/Tokyo)** まで可能。以降は不可。 | 「前日」は UsageDate の前日を指す。 | Rule | Scheduling |
| 取消理由 (CancelReason) | キャンセルの理由。`UserRequest / 無断キャンセル` を最小セット。 | 無断キャンセル は開始10分超過未Check-in。 | Enum | Scheduling |
| 無断キャンセル (無断キャンセル) | 予約開始から10分経過してもCheck-inがない状態。システムが自動キャンセル。 | 監査に reason=無断キャンセル を記録。 | Concept | Scheduling |
| イベント時間種別 (EventSpan) | イベント予約の時間種別。`半日(HalfDay)` / `終日(FullDay)`。 | HalfDayはDayHalfと連動。 | Enum | Scheduling |
| 予約明細 (BookingLine) | 予約に紐づく備品の引当要求。 | 0件以上。 | Entity | Scheduling |
| メンバー (Members) | 学生予約に紐づく学生の集合（1名以上）。全員の `StudentNumber` を保持。 | 予約種類=学生レンタルで必須。 | Value Object | Scheduling |
| 本人確認 (IdentityVerification) | 受付での本人確認結果。全員の学生証提示を **TA** が確認した記録。 | `verifiedBy=TAId` / `verifiedAt` / `verifiedMemberNumbers` を保持（番号の保存は最小限）。 | Value Object | Scheduling |
| 学生証提示 (StudentIdCheck) | 学生証の現物/電子提示による本人確認アクション。 | 画像の保存はしない。確認フラグと監査のみ。 | Process | Scheduling |
| 予約可能枠 (AvailableSlot) | 空いているスタジオ×日×限の組。 | 一覧画面で使用。 | DTO | Scheduling |
| 二重予約 (DoubleBooking) | 同一スタジオ×同一日で **時間枠(TimeSlot)** が重なる確定予約が複数存在する状態。 | 絶対禁止（不変条件）。 | 概念 | Scheduling |
| 備品 (EquipmentItem) | マイク、ケーブル、アンプなど貸し出す物。 | 物品マスタ。 | Entity | Inventory |
| 在庫数 (StockQuantity) | 備品の現在庫。0以上の整数。 | マスタ在庫とは別に「引当中」管理あり。 | Value Object | Inventory |
| 引当 (Allocation) | 予約に対して在庫を確保する行為。 | 予約確定時に実施。 | Domain Concept | Inventory |
| 貸出 (Checkout) | 実際に備品を学生に渡す行為。 | 当日カウンターで処理。 | Domain Concept | Inventory |
| 返却 (Return) | 貸し出した備品を受け取って戻す行為。 | 返却遅延はMVPでは扱わない。 | Domain Concept | Inventory |
| 貸出明細 (LoanLine) | どの予約に、どの備品を何個貸したかの記録。 | 会計はスコープ外。 | Entity | Inventory |
| 受付 (Reception) | フロントで行う対面処理の総称（Check-in/Check-out、貸出/返却）。 | 画面名・業務手順の呼称として統一。 | Process | Scheduling/Inventory |
| メンテ日 (MaintenanceDay) | スタジオを閉める日。 | 予約不可。 | Value Object | Scheduling |
| 予約カレンダー (BookingCalendar) | 予約状況を日付・限で一覧表示するビュー概念。 | クエリ用DTOで表現。 | DTO | Scheduling |

---
## 3. 命名・表記ルール（日本語↔英語）
- 予約 = Booking／予約番号 = BookingId／予約状態 = BookingStatus
- 学生 = Student／学生番号 = StudentNumber
- スタジオ = Studio／利用日 = UsageDate／限 = Period (P1..P5)
- 備品 = EquipmentItem／在庫 = Stock／引当 = Allocation／貸出 = Checkout／返却 = Return
- 予約種類 = ReservationType（StudentRental / ClassRental / EventReservation）
- 講師 = Instructor
- 時間枠 = TimeSlot（Period / HalfDay / FullDay）／半日区分 = DayHalf（AM/PM）
- 無断キャンセル = CancellationReason.unauthorized（英語表記が必要な場面のみ）
- **ブレやすい語の取り扱い**：
  - 「コマ」「枠」→ **限** に統一
  - 「ユーザー」「顧客」→ **学生** に統一
  - 「タイムスロット」→ **限** に統一

---
## 4. 不変条件（ビジネスルール／破るとバグ）
1) 重複禁止：同一 `Studio × UsageDate` で **TimeSlot の実時間レンジが重なる予約** は同時に存在できない（FullDay は当日の全Periodに相当／HalfDay は **DBの DayHalfMapping** で定義されたPeriod群に相当）。
2) 予約確定時に備品引当：予約明細に対して在庫が足りない場合は確定不可。
3) 在庫0未満禁止：引当・貸出・返却のいずれの操作でも在庫は負値にならない。
4) メンテ日・休業日は予約不可：スタジオ側のカレンダー優先。
5) 予約取消時の開放：備品の引当は自動で開放される。
6) 学生予約のCheck-in条件：**メンバー全員が揃い、全員の学生証提示をTAが確認** して本人確認が記録されている場合のみ `使用中` に遷移できる。
7) ユーザー都合キャンセルは **前日 23:59 (Asia/Tokyo)** まで。以降は不可。
8) 予約開始から **10分** 未Check-in なら **無断キャンセル** として自動キャンセル（`BookingCanceled{reason=無断キャンセル}`）。

---
## 5. ドメインイベント（名前だけ先に固定）
- `BookingConfirmed`（予約が確定した）
- `BookingCanceled`（予約が取消された。payloadに `reason` を含む：`UserRequest` または `無断キャンセル`）
- `EquipmentAllocated`（備品が引当られた）
- `EquipmentAllocationReleased`（取消等で引当が解放された）
- `EquipmentCheckedOut`（備品が貸し出された）
- `EquipmentReturned`（備品が返却された）
- `BookingCheckedIn`（スタジオ利用を開始した）
- `BookingCheckedOut`（スタジオ利用を終了した）
- `AllMembersVerified`（学生予約のメンバー全員の本人確認が完了した）

> Check-in/Check-out/貸出/返却 系イベントには **操作実行者（performedBy）= TAId** を必ず含めて監査可能にする。

> イベント名は英語キャメルケースで統一。監査や他システム連携を見据え、ペイロードは最小（IDと時刻、数量など）。

---
## 6. IDとフォーマット方針（初期値）
- `BookingId` / `StudioId` / `EquipmentId`：UUID（値オブジェクト化OK）。
- `InstructorId`：UUID（教職員識別）。
- `TAId`：UUID（受付担当の識別）。
- `StudentNumber`：先頭英字1–2 + 数字6–8 桁（例: `AB123456`）。
  - 入力時に前後空白トリム、全角→半角正規化、英字は大文字化。

---
## 7. 画面・APIでの用語の使い分け
- 一覧やカレンダーは **予約カレンダー** を使い、「空き」を **予約可能枠** と表記。
- 予約作成画面では **利用日**・**時間枠(TimeSlot)** を選ぶ。備品は **予約明細** として数量指定。
- 予約作成時に **予約者（学生/講師）** と **予約種類（学生レンタル/授業レンタル/イベント予約）** を選択。種類がイベントの場合は **EventSpan（半日/終日）** を選ぶ。
- **受付画面（TA向け）**：当日の確定予約一覧→`メンバー確認（学生証提示チェック）` → `Check-in / Check-out`、備品の `貸出 / 返却`。
  - 操作ごとに **performedBy: TAId** を記録する。
  - 予約開始から10分経過未Check-inの予約は **自動で無断キャンセルキャンセル**。UI上はキャンセル済みとして表示（手動操作不要）。
- **代行予約**：TAが窓口で予約を作成・取消できる（MVPでは任意）。
- エラーメッセージは表の用語をそのまま使う（例：「二重予約のため確定できません」）。

---
## 8. 今後の検討リスト（未確定・保留）
- 予約の「仮予約」「保留」状態を入れるか（決済や承認が絡むなら追加）。
- 返却遅延・破損・紛失の扱い（MVPでは除外）。
- 予約の上限（1日あたり学生ごとの最大数、備品の最大個数など）。
- 祝日や学内イベントによる予約不可日の自動反映。
- **HalfDay→Period の既定マッピング**（AM/PM がどの Period を包含するか）

---
## 9. ミニシナリオ（用語の使い方サンプル）
> 学生Sが、Aスタジオを10/10のP2で予約し、マイク2本を使いたい。
1) 学生Sは **利用日=2025-10-10、限=P2** を選ぶ。
2) システムは **予約可能枠** を表示。AスタジオのP2が空いている。
3) 学生Sは **予約** を作成し、**予約明細** にマイク×2を追加。
4) **予約確定** を実行 → 在庫が足りるため **引当** 成功、`BookingConfirmed` 発行。
5) 当日、カウンターで **貸出**（`EquipmentCheckedOut`）。利用後に **返却**（`EquipmentReturned`）。

---
### 仕上げメモ（運用ルール）
- 設計資料・UI文言・テスト名も、この用語表に合わせる。
- 新しい言葉が出たら、まずこの用語集に追記してから実装する。



---
## 追記用：要件追加テンプレート
> ここに新しい要件を貼り付ければ、そのまま設計に落とし込めるで。

- **ID**: REQ-XXX（連番）
- **要件名**: （短く）
- **概要**: （一言で）
- **詳細**: （業務フローがあれば簡単に）
- **不変条件/ルール**: （破れへん条件）
- **画面影響**: （追加/変更する画面）
- **API影響**: （新規/変更エンドポイント、入出力）
- **データモデル影響**: （新テーブル/カラム/VO/集約）
- **非機能**: （性能・監査・通知など）
- **受け入れ条件**: Given/When/Then で2〜3本

例：
- ID: REQ-012
- 要件名: 仮予約（15分ホールド）
- 概要: 予約作成中の枠を一時的に押さえる
- ルール: 15分経過/確定でホールド解除、重複は同一学生で1件まで
- 受け入れ: Given 空き枠、When 学生が仮予約、Then 15分間は他者から予約不可

## 追加候補（よくあるやつ）
> 必要なら番号で言うてくれたら、この用語集と設計に反映するで。
1) **ログイン/権限**（学生・事務/管理者の権限分離）
2) **仮予約＋タイムアウト**（例：15分ホールド）
3) **予約上限**（1日あたり学生の最大件数、備品の最大個数）
4) **祝日/メンテ日の自動反映**（学内カレンダー取込）
5) **予約変更/キャンセル規定**（締切・ペナルティ）
6) **通知**（作成/変更/取消/貸出・返却リマインド）
7) **料金計算**（スタジオ/備品の課金、今回はオプション）
8) **破損・紛失の申告**（在庫/精算への反映）
9) **レポート/集計**（利用状況、人気枠、備品回転率）
10) **監査ログ**（誰がいつ何をしたか、保持期間）



## 状態マッピング（StudioSlotStatus）
> 表示用の状態は **予約(Booking)** の状態＋現在時刻＋チェックインイベントから算出するで。

- **空**：該当 `TimeSlot` に有効な予約が存在しない。
- **予約済み**：`BookingStatus=Reserved` の予約が重なる。
- **予約確定**：`BookingStatus=Confirmed` の予約が重なる（かつ現在時刻は枠の開始前）。
- **使用中**：`BookingStatus=Confirmed` かつ現在時刻が `TimeSlot` 内、**TAによる Check-in 済み**。
  - `ReservationType=学生レンタル` の場合は **メンバー全員の学生証提示が確認済み**（AllMembersVerified=true）が必須。自動チェックインは学生レンタルには適用しない。
  - `授業レンタル/イベント予約` は通常のCheck-in要件に従う。
- **予約キャンセル**：`BookingStatus=Canceled`。理由は `CancelReason` に保持（`UserRequest` / `無断キャンセル`）。履歴表示に使用。通常の空き枠表示では「空」扱いでも良い（要件次第）。

**遷移の目安**（実装指針）
- `予約済み(Reserved)` →（承認/自動条件OK）→ `予約確定(Confirmed)`
- `予約確定` →（Check-in or 開始時刻到来＋自動チェックイン）→ `使用中`
- `予約済み/予約確定` →（キャンセル）→ `予約キャンセル`
- `使用中` →（終了/Check-out）→ 表示上は「空」（履歴は監査で保持）

---

## 追記：要件（2025-09-28）
- **REQ-021: 講師のスタジオ予約**
  - 概要: 予約者に講師を追加（学生以外も予約可）。
  - ルール: 予約者ロールに応じて閲覧/編集権限は将来拡張（MVPは同等権限）。
  - 受け入れ例:
    - Given 講師アカウント, When 予約作成, Then 予約が保存されカレンダーに表示される。

- **REQ-022: 予約種類の追加**
  - 概要: `学生レンタル`/`授業レンタル`/`イベント予約` を選択可能。
  - ルール: 種類は予約確定時に必須。検索・一覧の絞り込みキーにする。
  - 受け入れ例:
    - Given 予約作成画面, When 種類に「授業レンタル」を選ぶ, Then 予約詳細に種類が保存される。

- **REQ-023: イベント予約の半日/終日**
  - 概要: イベント予約は `EventSpan` を `半日(HalfDay)`/`終日(FullDay)` から選択。
  - ルール: 時間枠(TimeSlot)との整合を必須（HalfDayは設定されたPeriod群にマッピング／FullDayは全Periodと重なる）。
  - 受け入れ例:
    - Given 空き枠, When イベント予約(終日)を作成, Then 同日の全Periodの予約作成はブロックされる。



- **注記**：Instructor/TA は将来 `StaffRegistry` コンテキストに分離する可能性あり（当面は StudentRegistry に同居）。

---

### 追記要件（2025-09-28 その2）
- **REQ-024: TAによる受付業務**
  - 概要: TA が対面で `Check-in/Check-out` と備品の `貸出/返却` を行う。
  - ルール: すべての受付操作リクエストに `performedBy: TAId` を必須。操作は監査ログに保存。
  - 受け入れ例:
    - Given 当日の確定予約, When TA が Check-in 実行, Then 予約は「使用中」になりイベント `BookingCheckedIn(performedBy=TAId)` が記録される。
    - Given 貸出要求, When TA が 貸出 を確定, Then `EquipmentCheckedOut(performedBy=TAId)` が記録され在庫が減る。

- **REQ-025: 代行予約（任意・MVP外でも可）**
  - 概要: TA が窓口で学生/講師に代わって予約を作成・取消できる。
  - ルール: 予約作成時の予約者は学生/講師から選択し、TAの `performedBy` を監査に残す。
  - 受け入れ例:
    - Given 空き枠, When TA が学生Sの代わりに予約作成, Then 予約者=学生S, performedBy=TAId で保存される。



- **注記**：学生証番号等の過剰保存は避け、**確認済みフラグ＋監査ログ**（`verifiedMemberNumbers` は最小限）で運用する。

---

### 追記要件（2025-09-28 その3）
- **REQ-026: 学生予約の本人確認（全員揃って学生証提示）**
  - 概要: 学生レンタルのCheck-in時、**メンバー全員** が揃い、全員の学生証提示をTAが確認した場合のみスタジオ利用開始（`使用中`）にできる。
  - ルール:
    - 予約作成時に `members: StudentNumber[]` を必須。
    - 受付画面で各メンバーの提示チェックを行い、`AllMembersVerified=true` になったら Check-in 解放。
    - 自動チェックインは学生レンタルに適用しない。
  - 受け入れ例:
    - Given 学生予約(P2), メンバー=3名, When 2名のみ来場, Then Check-in不可（「全員揃ってません」エラー）。
    - Given 学生予約, When 3名全員が学生証提示→TAが確認, Then `AllMembersVerified` 記録後に `BookingCheckedIn` が可能となる。



---

### 追記要件（2025-09-28 その4）
- **REQ-027: 予約種類の優先度**
  - 概要: 優先順は **授業レンタル > イベント予約 > 学生レンタル**。
  - ルール: 自動奪取は行わず、同時受付や手動調整時の指針として適用。機械的には同時作成の競合解決（同時タイムスタンプの場合）にのみ使用。
  - 受け入れ例:
    - Given 同時刻に授業と学生の予約要求, When 予約処理, Then 授業レンタルが優先される。

- **REQ-028: キャンセル締切**
  - 概要: キャンセルは **前日 23:59 (Asia/Tokyo)** まで可能。
  - 受け入れ例:
    - Given UsageDate=2025-10-10, When 2025-10-09 23:59 までに取消, Then 成功。
    - Given 同上, When 2025-10-10 00:00 以降に取消, Then 失敗（締切超過）。

- **REQ-029: 無断キャンセル自動キャンセル（+10分）**
  - 概要: 予約開始から **10分** が経過しても Check-in がなければ、自動で `BookingCanceled{reason=無断キャンセル}` を発行。
  - 補足: `TimeSlot` の開始時刻は、Periodはその開始、HalfDay/FullDayは設定されたPeriod群の最初の開始時刻とみなす。
  - 受け入れ例:
    - Given 予約開始時刻=10:00, When 10:10 時点で未Check-in, Then 自動で無断キャンセルキャンセル。



---

## 追記：時間割設定（DB管理）
- **PeriodDefinition**（マスタ）：`periodId`（例:P1）/ 表示名（1限など）/ `startTime` / `endTime` / 並び順。
- **DayHalfMapping**（マスタ）：各 `periodId` を `AM` or `PM` に割当。
- **展開ルール**：`TimeSlot=Period` は単一レンジ、`HalfDay` は該当Period群の和集合、`FullDay` は当日の全Periodの和集合に展開して扱う。

### 追記要件（2025-09-28 その4）
- **REQ-027: Period定義のDB管理**
  - 概要: 1日のコマ数と各コマの開始/終了時刻をDBで管理する。
  - 受け入れ例:
    - Given PeriodDefinition(P1..P4), When 予約作成(TimeSlot=P3), Then P3の時間帯で重複判定される。
- **REQ-028: DayHalfMappingのDB管理**
  - 概要: 各PeriodがAM/PMのどちらかに属するかをDBで管理する。
  - 受け入れ例:
    - Given P1,P2=AM / P3,P4=PM, When TimeSlot=HalfDay(AM), Then P1,P2のいずれかと重なれば重複と判定される。
- **REQ-029: FullDayの展開**
  - 概要: FullDay は当日の全Periodに相当し、すべてのPeriodと重なるものとして扱う。
  - 受け入れ例:
    - Given P1..P4, When TimeSlot=FullDay, Then 同日のP1..P4いずれとも重複と判定される。



---

## 追記：無断キャンセル／猶予時間ポリシー（2025-09-28 その5）
> 自動キャンセル**しない**方針に変更。UIで10分経過を明示し、**TA がキャンセル操作**を行う。

### 用語
- **猶予時間(GracePeriod)**：予約開始から10分。
- **GraceExpired**：猶予時間を過ぎたフラグ（表示用）。
- **キャンセル理由=無断キャンセル**：メンバー未集合で開始できなかった取消理由。

### ルール
1) 予約開始から10分経過すると、その枠に **GraceExpired=true** を付与（自動判定）。
2) **自動キャンセルは行わない**。TA が受付画面から `BookingCanceled(reason=無断キャンセル, performedBy=TAId)` を実行する。
3) 既定のキャンセル締切「前日23:59まで」は維持。ただし **無断キャンセル理由** に限り、当日でも **TA取消可**。
4) 学生レンタルの Check-in 要件（**メンバー全員＋学生証提示**）は従来通り。満たされない限り `使用中` へ遷移しない。

### UI / API
- 受付画面：開始10分経過で当該予約行を**強調表示**（バッジ「10分経過」）。
- `GET /slots` / `GET /bookings/:id` に `graceExpired: boolean` と `graceMinutes: 10` を含める。
- 取消API：`POST /reception/cancel` で `reason=無断キャンセル` を必須、`performedBy=TAId` を記録。

### ドメインイベント（追加）
- `BookingGraceExpired`（開始10分経過を検知した：通知/可視化のため、取消は伴わない）
- `BookingCanceled`（reason=無断キャンセル, performedBy=TAId）

### 受け入れ例
- Given 予約開始, When 10分経過 & Check-in無, Then `graceExpired=true` がUI/APIに反映される（キャンセルはされない）。
- Given graceExpired=true, When TAが取消(reason=無断キャンセル)実行, Then `BookingCanceled` が記録されスロットは「空」に戻る（履歴は監査保存）。


---

## 追記：UI/UX方針（スマホ優先）
> 開発の優先順位は **スマホ表示 > PC表示**。レイアウトはモバイルファーストで設計し、PCは後追い最適化。

### ポリシー
- **モバイル基準幅**：幅 **390px**（iPhone系想定）で主要フローが完結できること。
- **コンポーネント方針**：
  - 予約カレンダー＝**リスト/カード**中心（表は避ける）。日付ピッカーは横スクロール可のチップ群。
  - 受付操作（Check-in/取消/貸出/返却）は **下部固定アクションバー** へ集約。
- **タップ領域**：主要ボタン/セルは **44px** 以上。
- **フォーム**：`type="tel|email|date|number|time"` を適切に指定。バリデーションはインライン表示。
- **画像/JS**：画像はWebP優先、アイコンはSVG。MVPではJSバンドルを**軽量**に保つ（大規模UIライブラリの多重採用は避ける）。
- **アクセシビリティ**：コントラスト比 4.5:1 以上、操作には `aria-label` を付与。

### 受け入れ条件（スマホ優先）
- **REQ-030-A**：`width=390px` で **スロット一覧**が横スクロール無しで閲覧でき、主要操作（予約/Check-in/取消）が **1タップ**圏にある。
- **REQ-030-B**：主要ボタンのタップ領域が **44px** 以上で誤タップが起きにくい（UIテストで検証）。
- **REQ-030-C**：`<meta name="viewport" content="width=device-width, initial-scale=1">` を設定し、フォントは少なくとも **16px**。

### 要件（ID付）
- **REQ-030: スマホ優先UI**
  - 概要: スマホからの利用を前提に、画面/操作/コンポーネントをモバイルファーストで設計する。
  - 影響: 画面設計・スタイル・コンポーネント選定・E2E/UIテスト観点。
  - 受け入れ: 上記 REQ-030-A/B/C を満たすこと。

