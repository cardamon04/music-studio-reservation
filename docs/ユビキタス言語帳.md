# ユビキタス言語帳（MVP v0.3）

作成日: 2025-09-28 / 想定タイムゾーン: Asia/Tokyo

このファイルは、要件定義で合意した用語を **日本語 / 英語 / 意味** で一覧化したものです。画面文言・APIスキーマ・テスト名に合わせてご利用ください。

---

## 1. 基本用語（エンティティ/VO/プロセス 等）

| 用語 (JP) | Term (EN) | 意味 / 使い方 | 種別 | 所属 |
|---|---|---|---|---|
| 学生 | Student | 本サービスの利用者。学生情報の主体。 | Entity | StudentRegistry |
| 学生番号 | StudentNumber | 学生を一意に識別する値。英数字10文字。例: AB12345678 | Value Object | StudentRegistry |
| 連絡先 | ContactInfo | 学生の名前・メール・電話などの連絡情報（最小収集）。 | Value Object | StudentRegistry |
| 講師 | Instructor | 授業やイベントでスタジオを予約できる教職員。 | Entity | StudentRegistry |
| TA（受付担当） | TeachingAssistant (TA) | 受付での対面処理（メンバー確認・チェックイン/アウト、備品の貸出/返却）を行う。 | Entity/Role | StudentRegistry |
| スタジオ | Studio | 予約対象の部屋。例：Aスタ、Bスタ。 | Entity | Scheduling |
| 利用日 | UsageDate | 予約や貸出の対象日。 | Primitive/VO | Scheduling |
| 限（コマ） | Period | 1日の時間コマ（数・開始/終了時刻はDB管理: PeriodDefinition）。 | Id/Enum | Scheduling |
| 半日区分 | DayHalf | AM/PM の区分（各PeriodのAM/PM割当はDB管理: DayHalfMapping）。 | Enum | Scheduling |
| 時間枠 | TimeSlot | 予約の時間単位。`Period / HalfDay / FullDay` の総称。内部では当日の実時間レンジ集合に展開して扱う。 | Value Object | Scheduling |
| 予約枠 | Slot | `Studio × UsageDate × TimeSlot` を1単位（セル）とした予約対象の単位。DBに固定行は持たず、その日のPeriod定義から動的に生成。 | Concept/DTO | Scheduling |
| Period定義 | PeriodDefinition | Periodの `periodId/名称/開始-終了/並び順` を保持する定義（DB管理）。 | Master | Scheduling |
| 半日対応 | DayHalfMapping | 各 `periodId` を AM/PM に割当てる定義（DB管理）。 | Master | Scheduling |
| 予約 | Booking | 学生/講師がスタジオを特定日・時間枠で利用する申込み。**学生レンタルではメンバー全員が対象**。 | Aggregate Root | Scheduling |
| 予約明細 | BookingLine | 予約に紐づく備品の引当要求（0件以上）。 | Entity | Scheduling |
| メンバー | Members | 学生予約に紐づく学生の集合（1名以上）。全員の `StudentNumber` を保持。 | Value Object | Scheduling |
| 本人確認 | IdentityVerification | 受付での本人確認結果。TAがメンバー全員の学生証提示を確認した記録。 | Value Object | Scheduling |
| 学生証提示 | StudentIdCheck | 学生証（現物/電子）の提示確認というアクション。画像は保存しない。 | Process | Scheduling |
| 受付 | Reception | 対面で行う処理の総称（メンバー確認、Check-in/Check-out、貸出/返却）。 | Process | Scheduling/Inventory |
| 予約可能枠 | AvailableSlot | 空いている `Studio × UsageDate × TimeSlot` の組（一覧用）。 | DTO | Scheduling |
| 予約カレンダー | BookingCalendar | 予約状況を日付・時間枠で一覧表示するビュー概念。 | DTO | Scheduling |
| 備品 | EquipmentItem | マイク、ケーブル、アンプなど貸し出す物。 | Entity | Inventory |
| 在庫数 | StockQuantity | 備品の現在庫。0以上の整数。 | Value Object | Inventory |
| 引当 | Allocation | 予約確定時に在庫を確保する行為。 | Domain Concept | Inventory |
| 貸出 | Checkout | 当日カウンターで備品を受け渡す行為。 | Domain Concept | Inventory |
| 返却 | Return | 貸し出した備品を受け取って戻す行為。 | Domain Concept | Inventory |
| 貸出明細 | LoanLine | どの予約に、どの備品を何個貸したかの記録。 | Entity | Inventory |
| メンテ日 | MaintenanceDay | スタジオを閉める日（予約不可）。 | Value Object | Scheduling |
| 猶予時間 | GracePeriod | 予約開始から10分の猶予。自動キャンセルはせず、UI表示のみでTAが判断して取消。 | Policy | Scheduling |
| 10分経過フラグ | GraceExpired | 猶予時間を過ぎた状態を示す表示用フラグ。 | Flag | Scheduling |

---

## 2. 列挙値（Enums）

### 2.1 予約状態（BookingStatus）

| 日本語 | 英語 | 意味 |
|---|---|---|
| 予約済み | Reserved | 申込が入ったが、確定条件（承認/在庫引当など）が未充足。 |
| 予約確定 | Confirmed | 確定条件が満たされた状態。開始時刻前。 |
| 予約キャンセル | Canceled | 取消された状態（理由は別途 CancelationReason で管理）。 |

### 2.2 スタジオ枠状態（StudioSlotStatus） ※表示用

| 日本語 | 英語 | 意味 |
|---|---|---|
| 空 | Empty | 有効な予約が存在しない。 |
| 予約済み | Reserved | `BookingStatus=Reserved` の予約が重なる。 |
| 予約確定 | Confirmed | `BookingStatus=Confirmed` の予約が重なる（開始前）。 |
| 使用中 | InUse | `Confirmed` かつ現在時刻が枠内、かつCheck-in済み。学生予約は**メンバー全員確認必須**。 |
| 予約キャンセル | Canceled | 直近で取消済みの履歴表示。通常の空き表示では「空」扱いにしても良い。 |

### 2.3 予約種類（ReservationType）

| 日本語 | 英語 | 備考 |
|---|---|---|
| 学生レンタル | StudentRental | 優先度低 |
| 授業レンタル | ClassRental | **最優先** |
| イベント予約 | EventReservation | 中優先 |

### 2.4 イベントの時間種別（EventSpan）

| 日本語 | 英語 | 意味 |
|---|---|---|
| 半日 | HalfDay | 当日のAMまたはPMに相当（DBの DayHalfMapping に従う）。 |
| 終日 | FullDay | 当日の全Periodに相当。 |

### 2.5 半日区分（DayHalf）

| 日本語 | 英語 | 意味 |
|---|---|---|
| 午前 | AM | DayHalf=AM |
| 午後 | PM | DayHalf=PM |

### 2.6 取消理由（CancellationReason）

| 日本語 | 英語 | 備考 |
|---|---|---|
| 無断キャンセル | unauthorized | 予約開始から10分経過・未チェックイン等。TAが取消時に選択。 |
| 利用者都合 | user_request | 前日23:59までの利用者都合の取消など。 |

---

## 3. ID / フォーマット

| 用語 (JP) | Term (EN) | 型/フォーマット | 備考 |
|---|---|---|---|
| 予約番号 | BookingId | UUID | 値オブジェクト化可 |
| スタジオID | StudioId | UUID |  |
| 備品ID | EquipmentId | UUID |  |
| 講師ID | InstructorId | UUID |  |
| TA ID | TAId | UUID |  |
| 学生番号 | StudentNumber | 英数字10文字 | 例: AB12345678 |

---

## 4. ドメインイベント

| Event (EN) | 日本語概要 | 主なペイロード |
|---|---|---|
| BookingConfirmed | 予約が確定した | bookingId, studioId, usageDate, timeSlot, reservationType, occurredAt |
| BookingCanceled | 予約が取消された | bookingId, reason（例: 無断キャンセル）, performedBy（TAId 任意）, occurredAt |
| EquipmentAllocated | 備品が引当られた | bookingId, equipmentId, quantity, occurredAt |
| EquipmentAllocationReleased | 引当が解放された | bookingId, equipmentId, quantity, occurredAt |
| EquipmentCheckedOut | 備品が貸し出された | bookingId, equipmentId, quantity, performedBy, occurredAt |
| EquipmentReturned | 備品が返却された | bookingId, equipmentId, quantity, performedBy, occurredAt |
| BookingCheckedIn | スタジオ利用を開始した | bookingId, performedBy（TAId）, occurredAt |
| BookingCheckedOut | スタジオ利用を終了した | bookingId, performedBy（TAId）, occurredAt |
| AllMembersVerified | 学生予約のメンバー全員の本人確認が完了した | bookingId, verifiedMemberNumbers[], verifiedBy（TAId）, verifiedAt |
| BookingGraceExpired | 予約開始10分の猶予が経過した（表示/通知用） | bookingId, graceMinutes=10, occurredAt |

---

## 5. ポリシー/不変条件（抜粋）

- **重複禁止**：同一 `Studio × UsageDate` で **TimeSlotの実時間レンジが重なる** 予約は同時に存在できない。  
  - FullDay は当日の全Periodに重なる。HalfDay は DayHalfMapping に定義されたPeriod群に重なる。  
- **予約期間制限**：予約は **今日から1週間後まで** のみ可能。過去の日付および1週間後以降の日付は予約不可。  
- **学生予約のCheck-in条件**：**メンバー全員が揃い、学生証提示をTAが確認**（AllMembersVerified）。自動Check-inは対象外。  
- **キャンセル締切**：前日 23:59 まで可。開始10分経過は自動取消せず、UI表示＋**TAが取消（理由=無断キャンセル）**。  
- **優先度**：`授業 > イベント > 学生`（自動奪取は行わない／同時受付時の指針）。

---

## 6. 表記ルール（日本語↔英語）

- 予約＝Booking／予約番号＝BookingId／予約状態＝BookingStatus／スタジオ枠状態＝StudioSlotStatus／予約枠＝Slot  
- 学生＝Student／学生番号＝StudentNumber／メンバー＝Members／講師＝Instructor／TA＝TeachingAssistant  
- 限＝Period／半日区分＝DayHalf（AM/PM）／時間枠＝TimeSlot（Period/HalfDay/FullDay）  
- 備品＝EquipmentItem／在庫＝Stock／引当＝Allocation／貸出＝Checkout／返却＝Return  
- 取消理由＝CancellationReason（**無断キャンセル**／利用者都合 など）

> **運用メモ**：新しい用語が出たら、まず本ファイルに追記してから実装へ反映すること。

---

## 7. 更新履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|------------|------|----------|--------|
| v1.0 | 2025-09-28 | 初版作成 | AI Assistant |
| v1.1 | 2025-01-27 | 1週間後までの予約制限を追加 | AI Assistant |
| v1.2 | 2025-01-27 | 学生管理機能を追加（学生検索API、学生名検索UI） | AI Assistant |
| v1.3 | 2025-01-27 | 学生番号形式を英数字10文字に変更 | AI Assistant |

---

**注記**: 本ユビキタス言語帳は音楽スタジオ予約システムMVPの用語定義です。実装時は本ファイルの用語定義に従って開発を進めてください。