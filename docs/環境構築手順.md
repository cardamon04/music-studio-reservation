# 音楽スタジオ予約システム 環境構築手順（MVP用）

## 1. プロジェクト作成

```bash
mkdir music-studio-reservation
cd music-studio-reservation
```

### バックエンド (Scala + Play)

```bash
sbt new playframework/play-scala-seed.g8
# プロジェクト名: studio-backend
```

### フロントエンド (Vue + TypeScript)

```bash
npm create vue@latest studio-frontend
cd studio-frontend
npm install
```

---

## 2. バックエンド設定

### build.sbt

```scala
name := "studio-backend"
organization := "com.amembow"
version := "1.0-SNAPSHOT"

lazy val root = (project in file("."))
  .enablePlugins(PlayScala)

scalaVersion := "2.13.16"

libraryDependencies ++= Seq(
  guice,
  jdbc,
  ehcache,
  specs2 % Test,
  "org.postgresql" % "postgresql" % "42.7.3",
  "org.flywaydb" % "flyway-core" % "10.17.3",
  "com.typesafe.play" %% "play-json" % "2.10.5",
  "net.logstash.logback" % "logstash-logback-encoder" % "7.4",
  "org.scalatestplus.play" %% "scalatestplus-play" % "7.0.2" % Test
)
```

### conf/routes

```routes
# Health check
GET     /api/ping        controllers.health.ApiHealthController.ping

# Assets (Twirlテンプレート用)
GET     /assets/*file    controllers.Assets.versioned(path="/public", file: Asset)
```

### app/controllers/health/ApiHealthController.scala

```scala
package controllers.health

import javax.inject.Inject
import play.api.mvc._
import play.api.libs.json._

class ApiHealthController @Inject() (cc: ControllerComponents) extends AbstractController(cc) {
  def ping(): Action[AnyContent] = Action {
    Ok(Json.obj("status" -> "ok", "message" -> "pong"))
  }
}
```

---

## 3. フロントエンド設定

### 依存追加

```bash
npm install vue-router@4 pinia
```

### vite.config.ts

```ts
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";

export default defineConfig({
  plugins: [vue()],
  server: {
    port: 5173,
    proxy: {
      "/api": {
        target: "http://localhost:9000",
        changeOrigin: true,
        secure: false,
      },
    },
  },
});
```

### src/main.ts

```ts
import { createApp } from "vue";
import App from "./App.vue";
import router from "./router";
import { createPinia } from "pinia";

const app = createApp(App);
app.use(router);
app.use(createPinia());
app.mount("#app");
```

### src/App.vue

```vue
<template>
  <RouterView />
</template>
```

### src/router/index.ts

```ts
import { createRouter, createWebHistory, type RouteRecordRaw } from "vue-router";
import PingView from "../views/PingView.vue";

const routes: RouteRecordRaw[] = [
  { path: "/", redirect: "/ping" },
  { path: "/ping", component: PingView },
];

const router = createRouter({
  history: createWebHistory(),
  routes,
});

export default router;
```

### src/views/PingView.vue

```vue
<template>
  <section>
    <h1>API Ping</h1>
    <button @click="call">Call /api/ping</button>
    <pre>{{ result }}</pre>
    <pre v-if="error">ERROR: {{ error }}</pre>
  </section>
</template>

<script setup lang="ts">
import { ref } from "vue";
import { apiGet } from "../lib/apiClient";

const result = ref<string>("(not called)");
const error = ref<string>("");

async function call(): Promise<void> {
  error.value = "";
  result.value = "(loading...)";
  try {
    const json = await apiGet("/ping");
    result.value = JSON.stringify(json, null, 2);
  } catch (e: any) {
    error.value = e?.message ?? String(e);
  }
}
</script>
```

### src/lib/apiClient.ts

```ts
export async function apiGet(path: string): Promise<any> {
  const res = await fetch(`/api${path}`, {
    method: "GET",
    headers: { "Accept": "application/json" },
  });
  if (!res.ok) {
    const body = await res.text();
    throw new Error(`GET ${path} failed: ${res.status} ${body}`);
  }
  return await res.json();
}
```

---

## 4. 起動 & 確認

### バックエンド (Play)

```bash
cd studio-backend
sbt run
# → http://localhost:9000/api/ping
# {"status":"ok","message":"pong"} が出ればOK
```

### フロントエンド (Vue)

```bash
cd studio-frontend
npm run dev
# → http://localhost:5173/ping
# Callボタン押下で pong が表示されればOK
```

---

## ✅ 環境構築のゴール

- Play 側で `/api/ping` が返る
- Vue 側から `/api/ping` を叩いて JSON が表示される
- ルーティング(Vue Router)と状態管理(Pinia)のベースができている
